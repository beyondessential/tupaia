{
  "description": "Indicator API features",
  "setup": {
    "dbRecords": {
      "entity": [{ "code": "GR", "name": "Greece", "type": "country" }],
      "indicator": [
        {
          "code": "AllColours",
          "builder": "arithmetic",
          "config": {
            "formula": "Red + Blue",
            "aggregation": "RAW"
          }
        },
        {
          "code": "RedAgainstBlue",
          "builder": "arithmetic",
          "config": {
            "formula": "Red / Blue",
            "aggregation": "RAW"
          }
        },
        {
          "code": "NonExistingBuilder",
          "builder": "nonExisting",
          "config": {}
        },
        {
          "code": "SelfReferencing",
          "builder": "arithmetic",
          "config": {
            "formula": "SelfReferencing - 1",
            "aggregation": "RAW"
          }
        },
        {
          "code": "CircularReference_A",
          "builder": "arithmetic",
          "config": {
            "formula": "CircularReference_B",
            "aggregation": "RAW"
          }
        },
        {
          "code": "CircularReference_B",
          "builder": "arithmetic",
          "config": {
            "formula": "CircularReference_A",
            "aggregation": "RAW"
          }
        }
      ]
    },
    "surveys": [
      {
        "code": "FavouriteColour",
        "questions": [
          { "code": "Red", "type": "Number" },
          { "code": "Blue", "type": "Number" }
        ]
      }
    ],
    "surveyResponses": [
      {
        "surveyCode": "Births",
        "entityCode": "AU",
        "submission_time": "2020-12-10T15:00:00Z",
        "answers": {
          "Red": "10",
          "Blue": "20"
        }
      }
    ]
  },
  "testCases": [
    {
      "description": "fetches data for multiple indicators",
      "input": {
        "indicatorCodes": ["AllColours", "RedAgainstBlue"],
        "fetchOptions": {
          "startDate": "2020-01-01",
          "endDate": "2020-12-31",
          "organisationUnitCodes": ["AU"]
        }
      },
      "expected": [
        {
          "dataElement": "AllColours",
          "organisationUnit": "AU",
          "period": "20201210",
          "value": 30
        },
        {
          "dataElement": "RedAgainstBlue",
          "organisationUnit": "AU",
          "period": "20201210",
          "value": 0.5
        }
      ]
    },
    {
      "description": "throws if a requested indicator builder does not exist",
      "input": {
        "indicatorCodes": ["NonExistingBuilder"],
        "fetchOptions": {
          "startDate": "2019-01-01",
          "endDate": "2019-12-31",
          "organisationUnitCodes": ["TO"]
        }
      },
      "throws": true,
      "expected": "'nonExisting' is not an indicator builder"
    },
    {
      "description": "throws for self referencing builders",
      "input": {
        "indicatorCodes": ["SelfReferencing"],
        "fetchOptions": {
          "startDate": "2019-01-01",
          "endDate": "2019-12-31",
          "organisationUnitCodes": ["TO"]
        }
      },
      "throws": true,
      "expected": "Max indicator nesting depth reached"
    },
    {
      "description": "throws for circular references",
      "input": {
        "indicatorCodes": ["CircularReference_A"],
        "fetchOptions": {
          "startDate": "2019-01-01",
          "endDate": "2019-12-31",
          "organisationUnitCodes": ["TO"]
        }
      },
      "throws": true,
      "expected": "Max indicator nesting depth reached"
    }
  ]
}
