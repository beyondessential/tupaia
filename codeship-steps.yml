# - name: Fetch environment variables
#   service: lastpass
#   command: './packages/devops/scripts/ci/setupEnvironmentVariables.sh'

# - type: parallel
#   name: Validate and test
#   exclude: -e2e$
#   steps:
#     - type: parallel
#       name: Validate
#       service: validation
#       steps:
#         - name: Validate branch name
#           command: './packages/devops/scripts/ci/validateBranchName.sh'
#         - name: Validate tests
#           command: './packages/devops/scripts/ci/validateTests.sh'
#     - type: parallel
#       name: Test
#       service: testing
#       steps:
#         - name: Test admin-panel-server
#           command: './packages/devops/scripts/ci/testBackend.sh admin-panel-server'
#         - name: Test lesmis-server
#           command: './packages/devops/scripts/ci/testBackend.sh lesmis-server'
#         - name: Test meditrak-server
#           command: './packages/devops/scripts/ci/testBackend.sh meditrak-server'
#         - name: Test web-config-server
#           command: './packages/devops/scripts/ci/testBackend.sh web-config-server'
#         - name: Test psss-server
#           command: './packages/devops/scripts/ci/testBackend.sh psss-server'
#         - name: Test report-server
#           command: './packages/devops/scripts/ci/testBackend.sh report-server'
#         - name: Test entity-server
#           command: './packages/devops/scripts/ci/testBackend.sh entity-server'
#         - name: Test database
#           command: './packages/devops/scripts/ci/testBackend.sh database'
#         - name: Test data-api
#           command: './packages/devops/scripts/ci/testBackend.sh data-api'
#         - name: Test auth
#           command: './packages/devops/scripts/ci/testBackend.sh auth'
#         - name: Test indicators
#           command: './packages/devops/scripts/ci/testBackend.sh indicators'
#         - name: Test internal-dependencies
#           command: './packages/devops/scripts/ci/testInternalDependencies.sh'
#         - name: Test web-frontend
#           command: './packages/devops/scripts/ci/testFrontend.sh web-frontend'

- name: Deploy changes
  service: deployment
  command: './triggerRedeploy.sh'

- type: parallel
  name: E2E test
  service: e2e
  tag: -e2e$
  steps:
    - name: E2E test web-frontend
      command: './packages/devops/scripts/ci/testE2e.sh web-frontend'
